import{g as W,f as U,u as Y,b as h,V as R,h as V,i as Q,j as X,p as Z,k as K,P as ee,O as te}from"./react-k3C6X3Ue.js";import{F as g,a as M,I as re,B as E,C as $,S as ne,T as j,R as oe,P as se,L as ie,b as ae,c as ce}from"./antd-CVHlxxsA.js";import{r as ue}from"./library-BKRPAIBe.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();var I={exports:{}},m={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var C;function le(){if(C)return m;C=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,o,s){var i=null;if(s!==void 0&&(i=""+s),o.key!==void 0&&(i=""+o.key),"key"in o){s={};for(var c in o)c!=="key"&&(s[c]=o[c])}else s=o;return o=s.ref,{$$typeof:t,type:r,key:i,ref:o!==void 0?o:null,props:s}}return m.Fragment=e,m.jsx=n,m.jsxs=n,m}var D;function fe(){return D||(D=1,I.exports=le()),I.exports}var a=fe(),de=ue();const S=W(de);function pe(t){const e=new Date(t);e.setSeconds(0,0);const r=t.getMinutes()%5;let o;if(r!==0){const i=5-r;o=new Date(e.getTime()+i*60*1e3)}else t.getTime()>e.getTime()?o=new Date(e.getTime()+5*60*1e3):o=e;const s=o.getTime()-t.getTime();return Math.floor(s/1e3)}const he=function(t,e,n){const r=function(u){return(u<15.5?"0":"")+Math.round(u).toString(16)},o=function(u){return parseInt(u,16)},s=function(u,b,N){return b+1>=u.length&&(u=Array(b+1-u.length).join(N)+u),u},i=S.enc.Hex.parse(t),c=Math.round(new Date().getTime()/1e3),f=s(r(Math.floor(c/n)),16,"0"),l=S.enc.Hex.parse(f),d=S.HmacSHA1(l,i).toString(S.enc.Hex),x=o(d.substring(d.length-1));let p=(o(d.substr(x*2,8))&o("7fffffff"))+"";return p=p.substring(p.length-e,p.length),p};function me(t){const e="18601C601BFE3C606E60CC601F02";if(t.match(/^\d{6,10}$/)){let n="";for(let r=0;r<t.length;r++)n+="0"+t[r];return he(n+e,8,300)}return""}const ye={histories:[]},A=U({name:"key-history",initialState:ye,reducers:{add:(t,e)=>{t.histories.length&&t.histories[t.histories.length-1].key===e.payload.key||t.histories.push(e.payload)},remove:(t,e)=>{const n=t.histories.findIndex(r=>r.key===e.payload.key);n!==-1&&t.histories.splice(n,1)},clear:t=>{t.histories=[]}}}),{add:ge,remove:We,clear:$e}=A.actions,xe=A.reducer;function B(t,e){const n=new Date(t),r=n.getSeconds();return n.setSeconds(r+e),n}const q=300;function L(t){return[Math.max(Math.floor(t/60),0).toString().padStart(2,"0"),Math.max(t%60,0).toString().padStart(2,"0")]}const be=()=>{const t=Y(),[e,n]=h.useState(""),[r,o]=h.useState(q),[s,i]=h.useState(-1),c=h.useCallback(async()=>{if(r<=0){await navigator.clipboard.writeText(""),R.error("密码已过期, 请重新生成");return}const l=`单次密码: [${e}], 有效期至${B(new Date,r).toLocaleString()}`;await navigator.clipboard.writeText(l),R.success("已复制到剪切板")},[e,r]),f=l=>{const d=me(l);if(e===d){R.error(`${L(r).join("分")}秒后再试`);return}const x=new Date,p=pe(x);t(ge({key:d,createDate:x,duration:p})),n(d),o(p),s!==-1&&clearInterval(s);const u=setInterval(()=>{o(b=>b-1)},1e3);i(u),setTimeout(()=>{clearInterval(u),f(l)},(r+1)*1e3)};return a.jsxs(g,{vertical:!0,style:{justifyContent:"space-between",paddingTop:"20px"},justify:"center",align:"center",children:[a.jsxs(M,{layout:"vertical",size:"large",onFinish:l=>f(l["admin-password"]),children:[a.jsx(M.Item,{style:{margin:0},label:"输入管理员密码",name:"admin-password",children:a.jsx(re,{type:"password"})}),a.jsx(g,{justify:"center",style:{margin:"20px 0"},children:a.jsx(E,{htmlType:"submit",type:"primary",children:"生成密码"})})]}),e?a.jsx($,{children:a.jsxs(ne,{direction:"vertical",align:"center",children:[a.jsxs(g,{align:"end",gap:8,children:[a.jsx(j.Text,{style:{fontWeight:"bold",fontSize:48,lineHeight:1},children:e}),a.jsx(E,{size:"large",icon:a.jsx(oe,{}),onClick:c})]}),a.jsx(se,{size:280,percent:r/q*100,type:"circle",status:r<=0?"exception":"success",format:(l,d)=>d?"/":L(r).join(":")})]})}):null]})},Se=()=>{const t=V(e=>e.keyHistory.histories);return a.jsx("div",{style:{overflowY:"scroll",height:"100vh"},children:a.jsx(ie,{dataSource:t.toReversed(),renderItem:(e,n)=>{const r=new Date(e.createDate),o=B(r,e.duration);return a.jsx($,{style:{paddingBottom:n===t.length-1?70:0},children:a.jsxs(g,{gap:24,justify:"space-between",children:[a.jsx(j.Text,{style:{fontWeight:"bold",fontSize:32,lineHeight:1},children:e.key}),a.jsxs(g,{vertical:!0,children:[a.jsxs(j.Text,{style:{fontSize:12},children:["生成：",r.toLocaleString()]}),a.jsxs(j.Text,{style:{fontSize:12},children:["过期：",o.toLocaleString()]})]})]})},e.key)}})})},ve=[{key:"generate",label:"密码生成",children:a.jsx(be,{})},{key:"history",label:"历史记录",children:a.jsx(Se,{})}];function _e(){return a.jsx(ae,{tabBarStyle:{backgroundColor:"white"},animated:{tabPane:!0,inkBar:!0},size:"large",style:{height:"100vh"},tabPosition:"bottom",items:ve,centered:!0})}var y={},v={},_={},H;function je(){if(H)return _;H=1,_.__esModule=!0,_.default=o;function t(s){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?t=function(c){return typeof c}:t=function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},t(s)}function e(){}var n={getItem:e,setItem:e,removeItem:e};function r(s){if((typeof self>"u"?"undefined":t(self))!=="object"||!(s in self))return!1;try{var i=self[s],c="redux-persist ".concat(s," test");i.setItem(c,"test"),i.getItem(c),i.removeItem(c)}catch{return!1}return!0}function o(s){var i="".concat(s,"Storage");return r(i)?self[i]:n}return _}var z;function we(){if(z)return v;z=1,v.__esModule=!0,v.default=n;var t=e(je());function e(r){return r&&r.__esModule?r:{default:r}}function n(r){var o=(0,t.default)(r);return{getItem:function(i){return new Promise(function(c,f){c(o.getItem(i))})},setItem:function(i,c){return new Promise(function(f,l){f(o.setItem(i,c))})},removeItem:function(i){return new Promise(function(c,f){c(o.removeItem(i))})}}}return v}var F;function Pe(){if(F)return y;F=1,y.__esModule=!0,y.default=void 0;var t=e(we());function e(r){return r&&r.__esModule?r:{default:r}}var n=(0,t.default)("local");return y.default=n,y}var Te=Pe();const Re=W(Te),Ie=Q({keyHistory:xe}),Oe={key:"root",storage:Re,blacklist:[]},ke=Z(Oe,Ie),J=X({reducer:ke,middleware:t=>t({serializableCheck:!1})});function w(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?w=function(n){return typeof n}:w=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},w(t)}function Me(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ee(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ce(t,e,n){return e&&Ee(t.prototype,e),t}function De(t,e){return e&&(w(e)==="object"||typeof e=="function")?e:P(t)}function O(t){return O=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},O(t)}function P(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function qe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)}function k(t,e){return k=Object.setPrototypeOf||function(r,o){return r.__proto__=o,r},k(t,e)}function T(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var G=function(t){qe(e,t);function e(){var n,r;Me(this,e);for(var o=arguments.length,s=new Array(o),i=0;i<o;i++)s[i]=arguments[i];return r=De(this,(n=O(e)).call.apply(n,[this].concat(s))),T(P(r),"state",{bootstrapped:!1}),T(P(r),"_unsubscribe",void 0),T(P(r),"handlePersistorState",function(){var c=r.props.persistor,f=c.getState(),l=f.bootstrapped;l&&(r.props.onBeforeLift?Promise.resolve(r.props.onBeforeLift()).finally(function(){return r.setState({bootstrapped:!0})}):r.setState({bootstrapped:!0}),r._unsubscribe&&r._unsubscribe())}),r}return Ce(e,[{key:"componentDidMount",value:function(){this._unsubscribe=this.props.persistor.subscribe(this.handlePersistorState),this.handlePersistorState()}},{key:"componentWillUnmount",value:function(){this._unsubscribe&&this._unsubscribe()}},{key:"render",value:function(){return typeof this.props.children=="function"?this.props.children(this.state.bootstrapped):this.state.bootstrapped?this.props.children:this.props.loading}}]),e}(h.PureComponent);T(G,"defaultProps",{children:null,loading:null});const Le=K(J);ce.createRoot(document.getElementById("root")).render(a.jsx(h.StrictMode,{children:a.jsx(ee,{store:J,children:a.jsxs(G,{loading:null,persistor:Le,children:[a.jsx(te,{}),a.jsx(_e,{})]})})}));
