import{g as K,f as ee,V as b,u as te,b as d,h as H,i as ue,j as le,p as fe,k as de,P as pe,O as he}from"./react-k3C6X3Ue.js";import{F as p,a as A,I as L,B as j,C as D,S as me,R as ye,T as y,b as ge,P as xe,L as re,c as be,d as Se,e as ve,f as je}from"./antd-DRLc_ntG.js";import{r as _e,v as Te}from"./library-CJEaMxTS.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();var $={exports:{}},S={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N;function we(){if(N)return S;N=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,o,i){var a=null;if(i!==void 0&&(a=""+i),o.key!==void 0&&(a=""+o.key),"key"in o){i={};for(var c in o)c!=="key"&&(i[c]=o[c])}else i=o;return o=i.ref,{$$typeof:t,type:r,key:a,ref:o!==void 0?o:null,props:i}}return S.Fragment=e,S.jsx=n,S.jsxs=n,S}var B;function Pe(){return B||(B=1,$.exports=we()),$.exports}var s=Pe(),Ce=_e();const P=K(Ce);function J(t){const e=new Date(t);e.setSeconds(0,0);const r=t.getMinutes()%5;let o;if(r!==0){const a=5-r;o=new Date(e.getTime()+a*60*1e3)}else t.getTime()>e.getTime()?o=new Date(e.getTime()+5*60*1e3):o=e;const i=o.getTime()-t.getTime();return Math.floor(i/1e3)}const Ie=function(t,e,n){const r=function(f){return(f<15.5?"0":"")+Math.round(f).toString(16)},o=function(f){return parseInt(f,16)},i=function(f,_,T){return _+1>=f.length&&(f=Array(_+1-f.length).join(T)+f),f},a=P.enc.Hex.parse(t),c=Math.round(new Date().getTime()/1e3),u=i(r(Math.floor(c/n)),16,"0"),g=P.enc.Hex.parse(u),m=P.HmacSHA1(g,a).toString(P.enc.Hex),E=o(m.substring(m.length-1));let h=(o(m.substr(E*2,8))&o("7fffffff"))+"";return h=h.substring(h.length-e,h.length),h};function Re(t){const e="18601C601BFE3C606E60CC601F02";if(t.match(/^\d{6,10}$/)){let n="";for(let r=0;r<t.length;r++)n+="0"+t[r];return Ie(n+e,8,300)}return""}const Me={histories:[]},ne=ee({name:"key-history",initialState:Me,reducers:{add:(t,e)=>{t.histories.length&&t.histories[t.histories.length-1].key===e.payload.key||t.histories.push(e.payload)},remove:(t,e)=>{const n=t.histories.findIndex(r=>r.key===e.payload.key);n!==-1&&t.histories.splice(n,1)},clear:t=>{t.histories=[]}}}),{add:ke,remove:st,clear:it}=ne.actions,Oe=ne.reducer;function oe(t,e){const n=new Date(t),r=n.getSeconds();return n.setSeconds(r+e),n}async function G(t,e=!0){try{await navigator.clipboard.writeText(t),e&&b.success("已复制到剪切板")}catch{b.success(t)}}function U(t){const e=Math.floor(Math.random()*t.length);return t[e]}const C=300;function Y(t){const e=Math.min(1,Math.max(0,t)),n={r:82,g:196,b:26},r={r:255,g:77,b:79},o=Math.round(n.r+(r.r-n.r)*e),i=Math.round(n.g+(r.g-n.g)*e),a=Math.round(n.b+(r.b-n.b)*e),c=u=>u.toString(16).padStart(2,"0");return`#${c(o)}${c(i)}${c(a)}`}function V(t){return[Math.max(Math.floor(t/60),0).toString().padStart(2,"0"),Math.max(t%60,0).toString().padStart(2,"0")]}const De=()=>{const t=te(),[e,n]=d.useState(""),[r,o]=d.useState(C),[i,a]=d.useState(-1),c=H(l=>l.tips.tips),[u,g]=d.useState(c.length?U(c).content:""),[m,E]=d.useState(""),[h,f]=d.useState(!0),_=d.useCallback(async()=>{if(r<=0){await G("",!1),b.error("密码已过期, 请重新生成");return}const l=new Date,w=`${h?(m||u)+`
`:""}密码: [${e}], 有效期至${oe(l,J(l)).toLocaleString()}, 开门后失效`;await G(w)},[e,r,m,u,h]),T=l=>{if(!l.match(/^\d{6,10}$/)){b.error("请输入6-10位的数字");return}const x=Re(l);if(e===x){b.error(`${V(r).join("分")}秒后再试`);return}const w=new Date,z=J(w);t(ke({key:x,createDate:w,duration:z})),n(x),o(z),i!==-1&&clearInterval(i);const W=setInterval(()=>{o(ce=>ce-1)},1e3);a(W),setTimeout(()=>{clearInterval(W),T(l)},(r+1)*1e3)};return s.jsxs(p,{vertical:!0,style:{justifyContent:"space-between",paddingTop:"10px"},justify:"center",align:"center",children:[s.jsxs(A,{layout:"vertical",size:"large",onFinish:l=>T(l["admin-password"]),children:[s.jsx(A.Item,{style:{margin:0},label:"输入管理员密码",name:"admin-password",children:s.jsx(L,{type:"password",pattern:"[0-9]{6,10}",inputMode:"numeric",minLength:6,maxLength:10})}),s.jsx(p,{justify:"center",style:{margin:"15px 0"},children:s.jsx(j,{htmlType:"submit",type:"primary",children:"生成密码"})})]}),e?s.jsx(D,{children:s.jsxs(p,{gap:20,vertical:!0,align:"center",children:[s.jsxs(p,{gap:12,align:"center",justify:"center",children:[s.jsx(me,{value:h,onChange:f}),s.jsx(L,{placeholder:u,value:m,onChange:l=>E(l.target.value)}),s.jsx(j,{size:"middle",style:{width:"48px",height:"36px"},icon:s.jsx(ye,{}),onClick:()=>g(c.length?U(c).content:"")})]}),s.jsxs(p,{align:"end",gap:8,children:[s.jsx(y.Text,{style:{fontWeight:"bold",fontSize:48,lineHeight:.7,fontFamily:"Courier New"},children:e}),s.jsx(j,{size:"large",icon:s.jsx(ge,{}),onClick:_})]}),s.jsx(xe,{size:280,percent:r/C*100,type:"circle",strokeColor:Y(1-r/C),status:r<=0?"exception":"success",format:(l,x)=>x?"/":s.jsx(y,{style:{fontSize:48,fontWeight:"bold",color:Y(1-r/C),fontFamily:"Courier New"},children:V(r).join(":")})})]})}):null]})},Ee=()=>{const t=H(e=>e.keyHistory.histories);return s.jsx("div",{style:{overflowY:"scroll",height:"80vh"},children:s.jsx(re,{dataSource:t.toReversed(),renderItem:e=>{const n=new Date(e.createDate),r=oe(n,e.duration);return s.jsx(D,{children:s.jsxs(p,{gap:24,justify:"space-between",children:[s.jsx(y.Text,{style:{fontWeight:"bold",fontSize:32,lineHeight:1,fontFamily:"Courier New"},children:e.key}),s.jsxs(p,{vertical:!0,children:[s.jsxs(y.Text,{style:{fontSize:12},children:["生成：",n.toLocaleString()]}),s.jsxs(y.Text,{style:{fontSize:12},children:["过期：",r.toLocaleString()]})]})]})},e.key)}})})},$e={tips:[]},se=ee({name:"tips",initialState:$e,reducers:{add:(t,e)=>{if(t.tips.find(r=>r.content===e.payload)){b.error("Tips内容重复");return}t.tips.push({id:Te(),createDate:new Date,content:e.payload})},remove:(t,e)=>{const n=t.tips.findIndex(r=>r.id===e.payload);n!==-1&&t.tips.splice(n,1)},clear:t=>{t.tips=[]}}}),{add:Le,remove:qe,clear:at}=se.actions,Fe=se.reducer,He=()=>{const t=te(),e=H(o=>o.tips.tips),[n,r]=d.useState("");return s.jsx("div",{style:{overflowY:"scroll",height:"80vh"},children:s.jsxs(p,{vertical:!0,children:[s.jsxs(D,{children:[s.jsx(y,{children:"添加新Tips："}),s.jsxs(p,{gap:8,children:[s.jsx(L,{value:n,onChange:o=>r(o.target.value)}),s.jsx(j,{type:"primary",onClick:()=>{t(Le(n)),r("")},children:"添加"})]})]}),s.jsx(re,{dataSource:e,renderItem:o=>s.jsx(D,{children:s.jsxs(p,{justify:"space-between",align:"center",children:[s.jsx(y,{children:o.content}),s.jsx(be,{title:"Delete the tip",description:"确认删除?",onConfirm:()=>t(qe(o.id)),okText:"确认",cancelText:"取消",children:s.jsx(j,{danger:!0,icon:s.jsx(Se,{})})})]})})})]})})},ze=[{key:"generate",label:"密码生成",children:s.jsx(De,{})},{key:"history",label:"历史记录",children:s.jsx(Ee,{})},{key:"tips",label:"Tips定义",children:s.jsx(He,{})}];function We(){return s.jsx(ve,{tabBarStyle:{width:"100%",backgroundColor:"white",position:"fixed",bottom:0},animated:{tabPane:!0,inkBar:!0},size:"large",tabPosition:"bottom",items:ze,centered:!0})}var v={},I={},R={},Q;function Ae(){if(Q)return R;Q=1,R.__esModule=!0,R.default=o;function t(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?t=function(c){return typeof c}:t=function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},t(i)}function e(){}var n={getItem:e,setItem:e,removeItem:e};function r(i){if((typeof self>"u"?"undefined":t(self))!=="object"||!(i in self))return!1;try{var a=self[i],c="redux-persist ".concat(i," test");a.setItem(c,"test"),a.getItem(c),a.removeItem(c)}catch{return!1}return!0}function o(i){var a="".concat(i,"Storage");return r(a)?self[a]:n}return R}var X;function Ne(){if(X)return I;X=1,I.__esModule=!0,I.default=n;var t=e(Ae());function e(r){return r&&r.__esModule?r:{default:r}}function n(r){var o=(0,t.default)(r);return{getItem:function(a){return new Promise(function(c,u){c(o.getItem(a))})},setItem:function(a,c){return new Promise(function(u,g){u(o.setItem(a,c))})},removeItem:function(a){return new Promise(function(c,u){c(o.removeItem(a))})}}}return I}var Z;function Be(){if(Z)return v;Z=1,v.__esModule=!0,v.default=void 0;var t=e(Ne());function e(r){return r&&r.__esModule?r:{default:r}}var n=(0,t.default)("local");return v.default=n,v}var Je=Be();const Ge=K(Je),Ue=ue({keyHistory:Oe,tips:Fe}),Ye={key:"root",storage:Ge,blacklist:[]},Ve=fe(Ye,Ue),ie=le({reducer:Ve,middleware:t=>t({serializableCheck:!1})});function M(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?M=function(n){return typeof n}:M=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},M(t)}function Qe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ze(t,e,n){return e&&Xe(t.prototype,e),t}function Ke(t,e){return e&&(M(e)==="object"||typeof e=="function")?e:k(t)}function q(t){return q=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},q(t)}function k(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function et(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&F(t,e)}function F(t,e){return F=Object.setPrototypeOf||function(r,o){return r.__proto__=o,r},F(t,e)}function O(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ae=function(t){et(e,t);function e(){var n,r;Qe(this,e);for(var o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return r=Ke(this,(n=q(e)).call.apply(n,[this].concat(i))),O(k(r),"state",{bootstrapped:!1}),O(k(r),"_unsubscribe",void 0),O(k(r),"handlePersistorState",function(){var c=r.props.persistor,u=c.getState(),g=u.bootstrapped;g&&(r.props.onBeforeLift?Promise.resolve(r.props.onBeforeLift()).finally(function(){return r.setState({bootstrapped:!0})}):r.setState({bootstrapped:!0}),r._unsubscribe&&r._unsubscribe())}),r}return Ze(e,[{key:"componentDidMount",value:function(){this._unsubscribe=this.props.persistor.subscribe(this.handlePersistorState),this.handlePersistorState()}},{key:"componentWillUnmount",value:function(){this._unsubscribe&&this._unsubscribe()}},{key:"render",value:function(){return typeof this.props.children=="function"?this.props.children(this.state.bootstrapped):this.state.bootstrapped?this.props.children:this.props.loading}}]),e}(d.PureComponent);O(ae,"defaultProps",{children:null,loading:null});const tt=de(ie);je.createRoot(document.getElementById("root")).render(s.jsx(d.StrictMode,{children:s.jsx(pe,{store:ie,children:s.jsxs(ae,{loading:null,persistor:tt,children:[s.jsx(he,{}),s.jsx(We,{})]})})}));
